<script>
    const googleSheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2yM00KOxREYPgLPvLL9PRm1FGQJwNu6U9UuDUOak_Wywn6DaKJBJ3obcmCVqXdRT0RTFenARDGEmw/pub?gid=817608384&single=true&output=csv";

    async function fetchBingoData() {
        const response = await fetch(googleSheetURL);
        const data = await response.text();
        return parseCSV(data);
    }

    function parseCSV(csvText) {
        const rows = csvText.trim().split("\n").map(row => row.split(","));
        let bingoData = { O: [], S: [], C: [], E: [], R: [] };

        // Go through each row and categorize data under the correct letter
        for (let row of rows.slice(1)) {  // Skip header row
            row.forEach((cell, index) => {
                if (!cell.trim()) return; // Skip empty cells

                // Determine column by first character (O, S, C, E, R)
                let colLetter = rows[0][index][0]; // First character of column name
                if (bingoData[colLetter]) {
                    bingoData[colLetter].push(cell.trim());
                }
            });
        }
        return bingoData;
    }

    async function generateBingoCard() {
        const tbody = document.querySelector("#bingo-table tbody");
        tbody.innerHTML = ""; // Clear existing table

        let bingoData = await fetchBingoData();

        let cardNumbers = {
            O: shuffleArray(bingoData["O"]).slice(0, 5),
            S: shuffleArray(bingoData["S"]).slice(0, 5),
            C: shuffleArray(bingoData["C"]).slice(0, 4), // One less for FREE space
            E: shuffleArray(bingoData["E"]).slice(0, 5),
            R: shuffleArray(bingoData["R"]).slice(0, 5),
        };

        for (let row = 0; row < 5; row++) {
            let tr = document.createElement("tr");
            ["O", "S", "C", "E", "R"].forEach((col, colIndex) => {
                let td = document.createElement("td");

                // Middle FREE space
                if (row === 2 && col === "C") {
                    td.textContent = "FREE";
                    td.classList.add("free-space");
                } else {
                    td.textContent = cardNumbers[col].shift();
                }

                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        }
    }

    function shuffleArray(arr) {
        return arr.sort(() => Math.random() - 0.5);
    }

    document.addEventListener("DOMContentLoaded", generateBingoCard);
</script>