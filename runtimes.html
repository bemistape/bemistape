<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stump the Buff - v2.1 (Fixed)</title>
  <style>
    /* ---------- GLOBAL / LAYOUT ---------- */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: white;
      font-family: Rockwell, serif;
    }
    .page-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
    }
    h1, h2, h3, p {
      margin: 0 0 10px 0;
    }
    button { cursor: pointer; }
    .version-number {
      text-align: center;
      font-size: 10px;
      opacity: 0.7;
      margin-top: 20px;
    }

    /* ---------- BUTTON STYLES ---------- */
    .diff-btn {
      background: #222;
      border: 2px solid #FFD700;
      color: white;
      font-size: 16px;
      padding: 8px 16px;
      margin: 5px;
    }
    .diff-btn:hover { background: #333; }
    #begin-btn {
      background: #FFD700;
      color: black;
      border: none;
      font-size: 22px;
      padding: 12px 30px;
      margin-top: 20px;
    }
    #begin-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ---------- INTRO PAGE ---------- */
    #intro-container, #game-container, #bonus-container, #final-container {
      display: none;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }
    #intro-container .intro-rules {
      max-width: 600px;
      font-size: 16px;
      line-height: 1.4;
      margin-bottom: 20px;
      text-align: center;
    }
    .difficulty-box { margin-bottom: 20px; }
    #loading-box {
      display: block;
      border: 2px solid #FFD700;
      padding: 30px;
      margin-top: 20px;
      font-size: 18px;
      width: 300px;
      text-align: center;
    }

    /* ---------- GAME PAGE ---------- */
    #timer-box {
      margin: 10px auto;
      width: 160px;
      height: 160px;
      background-color: #222;
      border-radius: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      font-weight: bold;
      color: white;
      border: 2px solid #444;
      transition: all 0.2s ease;
    }
    #movies-container, #runtimes-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .movie-card {
      width: 180px;
      border: 2px solid white;
      margin: 5px;
      padding: 10px;
      background-color: #000;
      border-radius: 12px;
      text-align: center;
      min-height: 100px;
      transition: background-color 0.2s, border-color 0.2s;
    }
    .movie-title { font-weight: bold; margin-bottom: 5px; }
    .runtime-card {
      width: 100px;
      height: 60px;
      border-radius: 30px;
      background-color: #FFD700;
      color: black;
      font-weight: bold;
      border: 2px solid #FFD700;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 5px;
      cursor: grab;
      /* Gentle up/down float */
      animation: float-run 3s ease-in-out infinite alternate;
    }
    @keyframes float-run {
      0%   { transform: translateY(0); }
      100% { transform: translateY(-5px); }
    }
    .correct {
      background-color: #003300 !important;
      border-color: #00FF00 !important;
      animation: pulse-green 0.5s;
    }
    .incorrect {
      background-color: #330000 !important;
      border-color: #FF0000 !important;
      animation: shake-red 0.5s;
    }
    @keyframes pulse-green {
      50% { transform: scale(1.05); }
    }
    @keyframes shake-red {
      20% { transform: translateX(-3px); }
      40% { transform: translateX(3px); }
      60% { transform: translateX(-3px); }
      80% { transform: translateX(3px); }
    }
    .stats-box {
      border: 1px solid #666;
      padding: 10px;
      margin: 10px auto;
      width: fit-content;
      min-width: 200px;
    }
    .stats-box.empty { display: none; }

    /* Joker button (clown emoji) */
    #joker-btn {
      display: inline-block;
      width: 80px;
      height: 80px;
      border-radius: 40px;
      font-size: 32px;
      background: #222;
      border: 2px solid #FFD700;
      color: white;
      margin: 10px auto;
    }
    #joker-btn:hover { background: #333; }
    .glow-anim {
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      0%   { box-shadow: 0 0 5px #FFD700; }
      100% { box-shadow: 0 0 20px #FFD700; }
    }

    /* ---------- BONUS ROUND ---------- */
    #bonus-container {
      text-align: center;
    }
    #bonus-timer-box {
      margin: 10px auto;
      width: 120px;
      height: 120px;
      background-color: #222;
      border-radius: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: bold;
      color: white;
      border: 2px solid #444;
      transition: all 0.2s ease;
      margin-bottom: 20px;
    }
    .bonus-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    .bonus-card {
      border: 2px solid white;
      border-radius: 50%;
      width: 100px;
      height: 100px;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }

    /* ---------- FINAL PAGE ---------- */
    #final-container { text-align: center; }
    #final-scores {
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: bold;
    }
    #details-toggle {
      margin-bottom: 10px;
      padding: 8px 16px;
      font-size: 14px;
      background: #222;
      color: white;
      border: 2px solid #FFD700;
      cursor: pointer;
    }
    #details-container {
      display: none;
      margin: 10px 0;
    }
    .breakdown-row {
      margin-bottom: 10px;
      text-align: center;
    }
    .final-round-row {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .final-card {
      border-radius: 10px;
      border: 2px solid #666;
      padding: 10px;
      text-align: center;
      width: 140px;
      background: #000;
      margin: 5px;
    }
    .final-card.correct {
      background-color: #003300;
      border-color: #0f0;
    }
    .final-card.incorrect {
      background-color: #330000;
      border-color: #f00;
    }
    #share-twitter-btn, #copy-recap-btn, #play-again-btn {
      display: inline-block;
      margin: 10px 8px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #222;
      color: white;
      border: 2px solid #FFD700;
    }
  </style>
</head>
<body>
  <!-- AUDIO FOR JOKER (placeholder beep) -->
  <audio id="joker-sound" preload="auto">
    <source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAIA+AAACABAAZGF0YQAAAAA=" type="audio/wav">
  </audio>

  <!-- INTRO SCREEN -->
  <div id="intro-container" class="page-container">
    <h1>Stump the Buff</h1>
    <div class="intro-rules">
      <p>In this game, you'll be given 5 movies each round.</p>
      <p>Drag the runtime card to the movie you think it belongs to.</p>
      <p>You have a limited time each round and can submit early.</p>
      <p>Use your <strong>Joker</strong> once to reveal the moviesâ€™ relative runtimes.</p>
    </div>
    <div class="difficulty-box">
      <label style="font-size:16px; margin-right:10px;">Difficulty:</label>
      <button class="diff-btn" data-difficulty="easy" id="easy-btn">Easy</button>
      <button class="diff-btn" data-difficulty="medium" id="medium-btn">Medium</button>
      <button class="diff-btn" data-difficulty="hard" id="hard-btn">Hard</button>
    </div>
    <div id="loading-box">
      <p>Loading data...</p>
    </div>
    <button id="begin-btn" disabled>Begin</button>
    <div class="version-number">v2.1 (Fixed)</div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-container" class="page-container">
    <div id="timer-box"><span id="timer-value">20</span></div>
    <h2 id="round-heading" style="font-family:Georgia, serif; margin:10px 0;"></h2>
    <button id="joker-btn" class="glow-anim" title="Use Joker (once)">ðŸ¤¡</button>
    <div id="movies-container" class="cards-container"></div>
    <div id="runtimes-container" class="cards-container"></div>
    <div id="this-game-stats" class="stats-box empty"></div>
    <button id="submit-btn">Submit</button>
  </div>

  <!-- BONUS ROUND (Simplified Grid) -->
  <div id="bonus-container" class="page-container">
    <div id="bonus-timer-box"><span id="bonus-timer-value">10</span></div>
    <h3 id="bonus-message"></h3>
    <div class="bonus-grid" id="bonus-grid"></div>
    <div id="bonus-result"></div>
    <button id="bonus-continue-btn">Continue</button>
  </div>

  <!-- FINAL SCREEN -->
  <div id="final-container" class="page-container">
    <div id="final-scores"></div>
    <button id="details-toggle">Show/Hide Details</button>
    <div id="details-container">
      <div id="round-breakdown"></div>
      <div id="final-cards-container"></div>
    </div>
    <div>
      <button id="share-twitter-btn">Share on Twitter</button>
      <button id="copy-recap-btn">Copy Recap</button>
      <button id="play-again-btn">Play Again?</button>
    </div>
  </div>

  <script>
    /* ALL THE JAVASCRIPT CODE â€“ includes final curly braces. */

    // ...
    // (Insert the entire corrected JS code from your previous snippet, 
    // making sure the showFinalScreen() function closes properly.)
    // ...

    // Here's the corrected showFinalScreen with the missing brace added:
    function showFinalScreen() {
      document.getElementById("game-container").style.display = "none";
      document.getElementById("final-container").style.display = "flex";

      const accuracy = (totalCorrect / 25) * 100;
      const skill = totalAnswered ? (totalDifference / totalAnswered) : 0;
      const fs = document.getElementById("final-scores");
      fs.innerText = `Final Score: ${Math.round(totalScore)}`;

      let breakdownHTML = "";
      roundScores.forEach(r => {
        breakdownHTML += `<div class="breakdown-row">
          Round ${r.roundIndex}: ${r.correct}/5 correct â†’ +${r.roundScore.toFixed(0)} pts
        </div>`;
      });
      breakdownHTML += `<div class="breakdown-row">
        Accuracy: ${accuracy.toFixed(1)}% | Skill: ${skill.toFixed(1)} min
      </div>`;

      document.getElementById("round-breakdown").innerHTML = breakdownHTML;

      // Show final 25 cards, labeled by round
      const finalCardsContainer = document.getElementById("final-cards-container");
      finalCardsContainer.innerHTML = "";
      rounds.forEach((round, idx) => {
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("final-round-row");

        // optional heading
        const heading = document.createElement("div");
        heading.style.textAlign = "center";
        heading.style.width = "100%";
        heading.style.fontWeight = "bold";
        heading.style.marginBottom = "5px";
        heading.innerText = `Round ${idx + 1}`;
        rowDiv.appendChild(heading);

        round.forEach(movie => {
          const actual = movie.runtime_minutes;
          const assigned = (movie._assignedRuntime !== null) ? movie._assignedRuntime : "-";
          const isCorrect = (assigned === actual);

          const card = document.createElement("div");
          card.classList.add("final-card");
          if (assigned !== "-") {
            card.classList.add(isCorrect ? "correct" : "incorrect");
          }
          card.innerHTML = `
            <div style="font-weight:bold; margin-bottom:5px;">${movie["Movie Name"]}</div>
            <div>Actual: ${movie.Runtime}</div>
            <div>Your Pick: ${assigned === "-" ? "-" : assigned + " min"}</div>
          `;
          rowDiv.appendChild(card);
        });
        finalCardsContainer.appendChild(rowDiv);
      });
    }
    
    // ...
    // (Rest of your JS code from the snippet, ensuring all curly braces match.)
  </script>
</body>
</html>
